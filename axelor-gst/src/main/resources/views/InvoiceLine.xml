<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	<form id="invoice-line-gst-form" name="invoice-line-form" title="Invoice line" model="com.axelor.apps.account.db.InvoiceLine" width="large"
		  onNew="action-account-invoice-line-onnew-group" 
		  onLoad="action-attrs-account-invoice-line-onnew-onload,action-invoice-line-attrs-readonly-form,action-invoice-line-record-gstrate-hsbn,action-invoice-line-record-netamount,action-invoice-line-record-gst-calc,action-invoice-line-record-grossamt">
		<panel hideIf="!isTitleLine">
			<field name="productName" colSpan="10" title="Title" requiredIf="isTitleLine"/>
			<field name="isTitleLine" colSpan="2" onChange="action-invoice-line-method-empty-line" widget="boolean-switch"/>
		</panel>
		<panel-tabs hideIf="isTitleLine">
			<panel name="informations" title="Information">
				<field name="product" canEdit="false" onChange="action-group-account-invoice-line-product-onchange,action-invoice-line-record-gstrate-hsbn,action-invoice-line-record-netamount,action-invoice-line-record-gst-calc,action-invoice-line-record-grossamt" form-view="product-form" grid-view="product-grid" domain="self.isModel = false"/>
				<field name="isTitleLine" colOffset="4" colSpan="2" onChange="action-invoice-line-method-empty-line" widget="boolean-switch"/>
				<field name="productName" colSpan="12" requiredIf="!isTitleLine"/>
				<field name="qty" colSpan="3" required="true" onChange="action-group-gst-invoice-line-qty-onchange,action-invoice-line-record-netamount,action-invoice-line-record-gst-calc,action-invoice-line-record-grossamt"/>
				<field name="unit" colSpan="3" canEdit="false" form-view="unit-form" grid-view="unit-grid"/>
				<field name="price" colSpan="3" required="true" onChange="action-group-gst-invoice-line-price-onchange,action-invoice-line-record-netamount,action-invoice-line-record-gst-calc,action-invoice-line-record-grossamt" hidden="true"/>
				<field name="inTaxPrice" colSpan="3" required="true" onChange="action-invoice-line-method-onchange-intaxprice,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount" hidden="true"/>
				<panel name="discount" colSpan="12">
					<field name="discountTypeSelect" colSpan="3" onChange="action-invoice-line-method-compute,action-invoice-line-attrs-discountamount-title,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount"/>
					<field name="discountAmount" colSpan="3" onChange="action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount" hideIf="discountTypeSelect == 3"/>
					<field name="priceDiscounted" colSpan="3" hidden="true"/>
				</panel>
				<panel title="GST Calculate" if="__config__.app.isApp('gst')">
					<field name="netAmount" colSpan="3" />
					<field name="igst" colSpan="3" />
					<field name="sgst" colSpan="3" />
					<field name="cgst" colSpan="3" />
					<field name="grossAmt" colSpan="3" />
					<field name="hsbn" colSpan="3" />
					<field name="gstRate" colSpan="3" />
				</panel>
				<field name="taxLine" onChange="action-invoice-line-method-convert-tax,action-invoice-line-method-compute,action-invoice-line-method-compute-analytic-distribution,action-budget-validate-exceed-line-amount" grid-view="tax-line-grid" form-view="tax-line-form"/>
				<field name="exTaxTotal" colSpan="3" readonly="true"/>
				<field name="inTaxTotal" colSpan="3" readonly="true"/>
				<field name="taxEquiv" hidden="true" grid-view="tax-equiv-grid" form-view="tax-equiv-form"/>
				<field name="invoice" hidden="true" />
        		<field name="companyExTaxTotal" hidden="true"/>
      			<field name="companyInTaxTotal" hidden="true"/>
				<panel title="Description" colSpan="12">
					<field name="description" showTitle="false" colSpan="12" widget="html" x-lite="true"/>
				</panel>
			</panel>
			<panel name="accounting" title="Accounting">
				<field name="account" onSelect="action-invoice-line-method-filter-account"/>
			</panel>
			<panel name="budgetPanel" title="Budget" if="__config__.app.isApp('budget')">
				<field name="budget" if="!__config__.app.getApp('budget').getManageMultiBudget()"/>
				<panel-related field="budgetDistributionList" editable="true" colSpan="12" if="__config__.app.getApp('budget').getManageMultiBudget()" onChange="action-budget-validate-exceed-line-amount"/>
			</panel>
			<panel name="projectPanel" if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectInvoiceLines()" title="Business Project" if-module="axelor-business-project" >
				<field name="project" onSelect="action-invoice-line-attrs-domain-project" form-view="project-form" grid-view="project-grid"/>
			</panel>
			<panel name="analyticDistribution" title="Analytics" if-module="axelor-supplychain" if="__config__.app.isApp('account') &amp;&amp; __config__.app.getApp('account').getManageAnalyticAccounting()" onTabSelect="action-invoice-line-attrs-read-only-distribution-lines">
				<field name="analyticDistributionTemplate" if="__config__.app.getApp('account').getAnalyticDistributionTypeSelect() == 1"/>
				<button name="generateDistributionLinesButton" onClick="action-invoice-line-method-create-distribution" title="Generate distribution lines" showIf="analyticDistributionTemplate != null" if="__config__.app.getApp('account').getAnalyticDistributionTypeSelect() == 1"/>
				<panel-related field="analyticMoveLineList" grid-view="analytic-move-line-distribution-grid" form-view="analytic-move-line-distribution-form" colSpan="12"/>
			</panel>
			<panel name="configuration" title="Configuration" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
				<field name="saleOrder" if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getManageInvoicedAmountByLine()" if-module="axelor-supplychain" form-view="sale-order-form" grid-view="sale-order-grid" />
				<field name="saleOrderLine" if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getManageInvoicedAmountByLine()" if-module="axelor-supplychain" form-view="sale-order-line-invoice-form" grid-view="sale-order-line-invoice-grid" domain="(self.saleOrder.statusSelect = 3 OR self.saleOrder.statusSelect = 4 ) AND EXISTS(SELECT i FROM Invoice i WHERE i = :invoice AND self.saleOrder.clientPartner = i.partner )"/>
				<field name="purchaseOrderLine" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')" form-view="purchase-order-line-form" grid-view="purchase-order-line-grid"/>
			</panel>
		</panel-tabs>
	</form>

	<action-record name="action-invoice-line-record-gstrate-hsbn"
		model="com.axelor.apps.account.db.InvoiceLine" if-module="axelor-gst">
		<field name="gstRate" expr="eval: product?.gstRate" />
		<field name="hsbn" expr="eval: product?.hsbn" />
	</action-record>

	<action-record name="action-invoice-line-record-netamount"
		model="com.axelor.apps.account.db.InvoiceLine" if-module="axelor-gst">
		<field name="netAmount" expr="eval: qty*price" />
	</action-record>

	<action-record name="action-invoice-line-record-gst-calc"
		model="com.axelor.apps.account.db.InvoiceLine" if-module="axelor-gst">
		<field name="igst" expr="eval: netAmount*gstRate"
			if="__parent__?.address.state != __parent__?.company.address.state" />
		<field name="sgst" expr="eval: (netAmount*gstRate)/2"
			if="__parent__?.address.state == __parent__?.company.address.state" />
		<field name="cgst" expr="eval: (netAmount*gstRate)/2"
			if="__parent__?.address.state == __parent__?.company.address.state" />
	</action-record>

	<action-record name="action-invoice-line-record-grossamt"
		model="com.axelor.apps.account.db.InvoiceLine" if-module="axelor-gst">
		<field name="grossAmt" expr="eval: netAmount*(igst+cgst)" />
	</action-record>

</object-views>
